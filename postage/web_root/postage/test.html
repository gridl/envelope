<!DOCTYPE html>
<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, minimal-ui" />

        <title>Postage Test Backend</title>

        <script src="/js/greyspots.js" type="text/javascript"></script>
        <link href="/css/greyspots.css" rel="stylesheet" type="text/css" />
        <link href="/css/postage.css" rel="stylesheet" type="text/css" />

        <script>
                GS.pushState({}, 'Postage Test Backend', '/postage/1/index.html');
                var Local = {};
                var test_random = Math.random().toString().substring(2);
                var test_change_stamp = new Date();
                test_change_stamp.setMinutes(test_change_stamp.getMinutes());
                test_change_stamp = test_change_stamp.toISOString().replace('T', ' ').replace(/\..*/gi, '');
                Local.tests = [
			['File Read Fail', 'ajax', 404, '/test2.txt', '',
				ml(function () {/*"The file you are requesting is not here."*/ })],
			['File Read', 'ajax', 200, '/test.txt', '',
				ml(function () {/*TESTING*/ })],
			['List Connections', 'ajax', 200, '/postage/auth', 'action=list',
				ml(function () {/*localhost:5432
test
ip example
host example*/})],
			['Login Fail 1', 'ajax', 500, '/postage/auth', 'action=login&connname=doesntexist&username=postgres&password=password',
				ml(function () {/*"FATAL\nThere is no connection info with that name."*/ })],
			['Login Fail 2', 'ajax', 500, '/postage/auth', 'action=login&connname=test&username=doesntexist&password=password',
				ml(function () {/*"FATAL\nConnect failed: FATAL:  password authentication failed for user \"doesntexist\"\n"*/ })],
			['Login', 'ajax', 200, '/postage/auth', 'action=login&connname=test&username=postgres&password=password',
				ml(function () {/*{"stat": true, "dat": "/postage/1/index.html"}*/ })],
			['Invalid Action', 'ajax', 500, '/postage/auth', 'action=change_password&password_old=password&password_new=test1',
				ml(function () {/*"Not a valid action."*/ })],
			['Change Password', 'ajax', 200, '/postage/auth', 'action=change_pw&password_old=password&password_new=test1',
				ml(function () {/*{"stat": true, "dat": "OK"}*/ })],
			['Change Password Fail', 'ajax', 500, '/postage/auth', 'action=change_pw&password_old=test&password_new=test',
				ml(function () {/*"FATAL\nOld password does not match."*/ })],
			['Change Password', 'ajax', 200, '/postage/auth', 'action=change_pw&password_old=test1&password_new=password',
				ml(function () {/*{"stat": true, "dat": "OK"}*/ })],
			['Change Database', 'ajax', 200, '/postage/auth', 'action=change_database&database=template1',
				ml(function () {/*{"stat": true, "dat": "OK"}*/ })],
			['Change Database Fail', 'ajax', 500, '/postage/auth', 'action=change_database&database=template2',
				ml(function () {/*"FATAL\nConnect failed: FATAL:  database \"template2\" does not exist\n"*/ })],
			['Change Database', 'ajax', 200, '/postage/auth', 'action=change_database&database=postgres',
				ml(function () {/*{"stat": true, "dat": "OK"}*/ })],
			['Upload Fail', 'ajax', 500, '/postage/1/upload', '',
				ml(function () {/*"FATAL\nget_sun_upload failed"*/ })],
			['Upload', 'upload', 200, '/postage/1/upload', '/open/test' + test_random + '.sql',
				ml(function () {/*Upload Succeeded
*/})],
			['Download Fail', 'ajax', 404, '/postage/1/download/test' + test_random + '.sql', '',
				ml(function () {/*"The file you are requesting is not here."*/ })],
			['Download', 'ajax', 200, '/postage/1/download/open/test' + test_random + '.sql', '',
				ml(function () {/*SELECT 'This is some test sql';*/ })],
			['Export Fail 1', 'ajax', 500, '/postage/1/export', 'SELECT \'test',
				ml(function () {/*"FATAL\nstrstr failed"*/ })],
			['Export Fail 2', 'ajax', 500, '/postage/1/export', 'SELECT \'test\n' +
				'FORMAT	DELIMITER	NULL	QUOTE	ESCAPE	HEADER\n' +
				'\'csv\'	\',\'	\'NULL\'	\'"\'	\'\\\'	TRUE',
				ml(function () {/*"FATAL\nQuery failed: ERROR:  syntax error at or near \"csv\"\nLINE 4:   FORMAT 'csv',\n                  ^\n"*/ })],
			['Export', 'ajax', 200, '/postage/1/export', 'SELECT \'test\' AS result\n' +
				'FORMAT	DELIMITER	NULL	QUOTE	ESCAPE	HEADER\n' +
				'\'csv\'	\',\'	\'NULL\'	\'"\'	\'\\\'	TRUE',
				ml(function () {/*result
test
*/})],
			['WEBSOCKET OPEN W/INFO ACTION', 'websocket start', '', '', ''],
			['TAB LIST FAIL 1', 'websocket', '', 'TAB LIST /open/',
			['strstr failed', 'TRANSACTION COMPLETED']],
			['TAB LIST FAIL 2', 'websocket', '', 'TAB\tLIST\t/ipen/',
			['Failed to get canonical path', 'TRANSACTION COMPLETED']],
			['TAB LIST', 'websocket', '', 'TAB\tLIST\t/open/',
			['ANYTHING', 'TRANSACTION COMPLETED']],
			['TAB READ FAIL', 'websocket', '', 'TAB\tREAD\t/ipen/test' + test_random + '.sql',
			['Failed to get canonical path', 'TRANSACTION COMPLETED']],
			['TAB READ', 'websocket', '', 'TAB\tREAD\t/open/test' + test_random + '.sql',
			['ANYTHING', 'TRANSACTION COMPLETED']],
			['TAB WRITE FAIL 1', 'websocket', '', 'TAB\tWRITE\t/open/test' + test_random + '.sql\t10000000000000\nThis is a test\n',
			['strptime() failed', 'TRANSACTION COMPLETED']],
			['TAB WRITE FAIL 2', 'websocket', '', 'TAB\tWRITE\t/open/test' + test_random + '.sql 10000000000000\nThis is a test\n',
			['strstr failed', 'TRANSACTION COMPLETED']],
			['TAB WRITE', 'websocket', '', 'TAB\tWRITE\t/open/test' + test_random + '.sql\t' + test_change_stamp + '\nThis is a test\n',
			['ANYTHING', 'TRANSACTION COMPLETED']],
			['TAB MOVE FAIL', 'websocket', '', 'TAB\tMOVE\t/ipen/test' + test_random + '.sql\t/closed/test' + test_random + '.sql\n',
			['Failed to get canonical path', 'TRANSACTION COMPLETED']],
			['TAB MOVE', 'websocket', '', 'TAB\tMOVE\t/open/test' + test_random + '.sql\t/closed/test' + test_random + '.sql\n',
			['ANYTHING', 'TRANSACTION COMPLETED']],
			['RAW', 'websocket', '', ml(function () {/*RAW
SELECT 'This is some test sql';
*/}),
			[
                                'QUERY\tSELECT \'This is some test sql\';',
                                'START',
                                'END',
                                'ROWS\t1',
                                'COLUMNS\n?column?\nunknown\n',
                                'This is some test sql',
                                '\\.',
                                'TRANSACTION COMPLETED'
			]],
			['RAW W/NOTIFY', 'websocket', '', ml(function () {/*RAW
LISTEN postgres;
CREATE TABLE IF NOT EXISTS rtesting_table
(
id integer,
test_name character varying(150),
CONSTRAINT rtesting_table_pk PRIMARY KEY (id)
) WITH (
OIDS=FALSE
);
CREATE OR REPLACE VIEW ttesting_view AS
 SELECT id, test_name
   FROM (
	 SELECT id, test_name
       FROM (SELECT id, test_name
         FROM (SELECT id, test_name
           FROM rtesting_table
          ) em1
       ) em2
     ) em3;
NOTIFY postgres, 'testing';
*/}),
			[
                                "QUERY\tLISTEN postgres;",
                                "START",
                                "END",
                                "Rows Affected\n0\n",
                                "QUERY\t\\nCREATE TABLE IF NOT EXISTS rtesting_table\\n(\\nid integer,\\ntest_name character varying(150),\\nCONSTRAINT rtesting_table_pk PRIMARY KEY (id)\\n) WITH (\\nOIDS=FALSE\\n);",
                                "START",
                                "OPTIONALNOTICE\t CREATE TABLE / PRIMARY KEY will create implicit index \"rtesting_table_pk\" for table \"rtesting_table\"\\n",
                                "OPTIONALNOTICE\t relation \"rtesting_table\" already exists, skipping\\n",
                                "END",
                                "Rows Affected\n0\n",
                                "QUERY\t\\nCREATE OR REPLACE VIEW ttesting_view AS\\n SELECT id, test_name\\n   FROM (\\n\\t SELECT id, test_name\\n       FROM (SELECT id, test_name\\n         FROM (SELECT id, test_name\\n           FROM rtesting_table\\n          ) em1\\n       ) em2\\n     ) em3;",
                                "START",
                                "END",
                                "Rows Affected\n0\n",
                                "QUERY\t\\nNOTIFY postgres, 'testing';",
                                "START",
                                "END",
                                "Rows Affected\n0\n",
                                "TRANSACTION COMPLETED"
			]],
			['SELECT FAIL', 'websocket', '', ml(function () {/*SELECT	rtesting_table
RETURN	id	test_name	test_full

ORDER BY
id DESC
*/}),
			['Query failed: ERROR:  column rtesting_table.test_full does not exist\nLINE 1: ...esting_table\".\"id\", \"rtesting_table\".\"test_name\", \"rtesting_...\n                                                             ^\n']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['SELECT', 'websocket', '', ml(function () {/*SELECT	rtesting_table
RETURN	id	test_name

ORDER BY
id DESC
*/}),
			['id\ttest_name\ninteger\tcharacter varying(150)\n', 'TRANSACTION COMPLETED']],
			['ROLLBACK', 'websocket', '', ml(function () {/*ROLLBACK*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['INSERT FAIL 1', 'websocket', '', ml(function () {/*INSERT	rtesting_table
RETURN	id	test_name
PK	id	
SEQ	id	

id	test_name
1	Bob
2	Alice
3	Eve
*/}),
			['Query failed: ERROR:  relation "id" does not exist\n']],
			['ROLLBACK', 'websocket', '', ml(function () {/*ROLLBACK*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['INSERT FAIL 2', 'websocket', '', ml(function () {/*INSERT	ttesting_view
RETURN	id	test_name
PK	id	
SEQ		

id	test_name
1	Bob
2	Alice
3	Eve
*/}),
			[
			 [
			  'Query failed: ERROR:  cannot insert into view \"ttesting_view\"\nHINT:  You need an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.\n',
			  'Query failed: ERROR:  cannot insert into view \"ttesting_view\"\nDETAIL:  Views that do not select from a single table or view are not automatically updatable.\nHINT:  To enable inserting into the view, provide an INSTEAD OF INSERT trigger or an unconditiona'
			 ]
			]],
			['ROLLBACK', 'websocket', '', ml(function () {/*ROLLBACK*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['INSERT', 'websocket', '', ml(function () {/*INSERT	rtesting_table
RETURN	id	test_name
PK	id	
SEQ		

id	test_name
1	Bob
2	Alice
3	Eve
*/}),
			['1\tBob\n2\tAlice\n3\tEve\n', 'TRANSACTION COMPLETED']],
			['COMMIT', 'websocket', '', ml(function () {/*COMMIT*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['UPDATE FAIL 1', 'websocket', '', ml(function () {/*UPDATE	rtesting_table
RETURN	id	tes_name

pk	set
id	test_name
1	Bobby
2	Alicia
*/}),
			[
			 [
			  'Query failed: ERROR:  column rtesting_table.tes_name does not exist\nLINE 1: COPY (SELECT \"rtesting_table\".\"id\", \"rtesting_table\".\"tes_na...\n                                            ^\n',
			  'Query failed: ERROR:  column rtesting_table.tes_name does not exist\nLINE 1: COPY (SELECT \"rtesting_table\".\"id\", \"rtesting_table\".\"tes_na...\n                                            ^\nHINT:  Perhaps you meant to reference the column \"rtesting_table.tes'
			 ]
			]],
			['ROLLBACK', 'websocket', '', ml(function () {/*ROLLBACK*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['UPDATE FAIL 2', 'websocket', '', ml(function () {/*UPDATE	ttesting_view
RETURN	id	test_name

pk	set
id	test_name
1	Bobby
2	Alicia
*/}),
			[
			 [
			  'Query failed: ERROR:  cannot update view \"ttesting_view\"\nHINT:  You need an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.\n',
			  'Query failed: ERROR:  cannot update view \"ttesting_view\"\nDETAIL:  Views that do not select from a single table or view are not automatically updatable.\nHINT:  To enable updating the view, provide an INSTEAD OF UPDATE trigger or an unconditional ON UPDATE'
			 ]
			]],
			['ROLLBACK', 'websocket', '', ml(function () {/*ROLLBACK*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['UPDATE', 'websocket', '', ml(function () {/*UPDATE	rtesting_table
RETURN	id	test_name

pk	set
id	test_name
1	Bobby
2	Alicia
*/}),
			['1\tBobby\n2\tAlicia\n', 'TRANSACTION COMPLETED']],
			['COMMIT', 'websocket', '', ml(function () {/*COMMIT*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['DELETE FAIL 1', 'websocket', '', ml(function () {/*DELETE rtesting_table
pk
id
1
2
3
*/}),
			['Failed to get table name from query']],
			['ROLLBACK', 'websocket', '', ml(function () {/*COMMIT*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['DELETE FAIL 2', 'websocket', '', ml(function () {/*DELETE	ttesting_view

pk
id
1
2
3
*/}),
			[
			 [
			  'Query failed: ERROR:  cannot delete from view \"ttesting_view\"\nHINT:  You need an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.\n',
			  'Query failed: ERROR:  cannot delete from view \"ttesting_view\"\nDETAIL:  Views that do not select from a single table or view are not automatically updatable.\nHINT:  To enable deleting from the view, provide an INSTEAD OF DELETE trigger or an unconditional'
			 ]
			]],
			['ROLLBACK', 'websocket', '', ml(function () {/*COMMIT*/ }),
			['OK']],
			['BEGIN', 'websocket', '', ml(function () {/*BEGIN*/ }),
			['OK']],
			['DELETE', 'websocket', '', ml(function () {/*DELETE	rtesting_table

pk
id
1
2
3
*/}),
			['Rows Affected\n3\n', 'TRANSACTION COMPLETED']],
			['COMMIT', 'websocket', '', ml(function () {/*COMMIT*/ }),
			['OK']],
			['WEBSOCKET CLOSE', 'websocket end', '', '', ''],
			['Logout', 'ajax', 200, '/postage/auth', 'action=logout',
				ml(function () {/*<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-GB">
<head><script>window.open('/', '_self');</scr*/}) + ml(function () {/*ipt></head><body></body></html>*/ })]
                ];
                //ml(function () {/*asdfasdfasdf*/})
                window.addEventListener('load', function () {
                        var i, len;
                        var strHTML = '';
                        for (i = 0, len = Local.tests.length; i < len; i++) {
                                var arrCurrent = Local.tests[i];
                                var strName = arrCurrent[0];
                                strHTML +=
                                        '<gs-block id="test' + i + '_label" class="waiting">' +
                                                '<label>' + strName + '</label>' +
                                        '</gs-block>';
                        }
                        document.getElementById('gridtests').innerHTML = strHTML;
                        GS.ajaxText('/postage/index.html', '', function (data, error) {
                                if (!error) {
                                        Local.tests[Local.tests.length - 1][5] = data;
                                        run_test(0);
                                } else {
                                        change_status(0, 'waiting', 'error');
                                        document.getElementById('actual_status').value = ajax.status;
                                        document.getElementById('actual_output').value = data.error_text;
                                }
                        });
                });
                function change_status(intCurrent, strOldClass, strNewClass) {
                        var objLabel = document.getElementById('test' + intCurrent + '_label');
                        objLabel.classList.remove(strOldClass);
                        objLabel.classList.add(strNewClass);
                        if (strNewClass === 'fail') {
                                GS.pushState({}, 'Postage Test Backend', '/postage/test.html');
                        }
                }
                Object.prototype.toString = function () {
                        return JSON.stringify(this);
                };
                var bol_run = true;
                function run_test(intCurrent) {
                        var arrCurrent = Local.tests[intCurrent];
                        if (arrCurrent === undefined) {
                                if (bol_run) {
                                        for (i = 0, len = Local.tests.length; i < len; i++) {
                                                change_status(i, 'pass', 'waiting');
                                        }
                                        test_random = Math.random().toString().substring(2);
                                        Local.tests[14][4] = '/open/test' + test_random + '.sql'
                                        Local.tests[16][3] = '/postage/1/download/open/test' + test_random + '.sql'
                                        run_test(0);
                                } else {
                                        GS.pushState({}, 'Postage Test Backend', '/postage/test.html');
                                }
                                var num = parseInt(document.getElementById('iterations').innerText, 10);
                                document.getElementById('iterations').innerText = num + 1;
                                return;
                        }
                        var strName = arrCurrent[0];
                        var strType = arrCurrent[1];
                        if (strType === 'ajax') {
                                arrCurrent[5] = arrCurrent[5].replace(/\r\n/gi, '\n');

                                var intStatusCode = arrCurrent[2];
                                var strLink = arrCurrent[3];
                                var strArgs = arrCurrent[4];
                                var strExpectedOutput = arrCurrent[5];
                                change_status(intCurrent, 'waiting', 'running');
                                var ajax = GS.ajaxText(strLink, strArgs, function (data, error) {
                                        //console.log('>' + intCurrent + '|' + data + '|' + error + '<');
                                        //console.log(data);
                                        //console.log(data.error_text);
                                        if (!error) {
                                                data = data.replace(/\r\n/gi, '\n');
                                                if (data === strExpectedOutput && intStatusCode === ajax.status) {
                                                        change_status(intCurrent, 'running', 'pass');
                                                        run_test(intCurrent + 1);
                                                } else {
                                                        change_status(intCurrent, 'running', 'fail');
                                                        document.getElementById('actual_status').value = ajax.status;
                                                        document.getElementById('actual_output').value = data;
                                                }
                                        } else {
                                                if (data.error_text === strExpectedOutput && intStatusCode === ajax.status) {
                                                        change_status(intCurrent, 'running', 'pass');
                                                        run_test(intCurrent + 1);
                                                } else {
                                                        change_status(intCurrent, 'running', 'fail');
                                                        document.getElementById('actual_status').value = ajax.status;
                                                        document.getElementById('actual_output').value = data.error_text;
                                                }
                                        }
                                });
                        } else if (strType === 'upload') {
                                arrCurrent[5] = arrCurrent[5].replace(/\r\n/gi, '\n');
                                var intStatusCode = arrCurrent[2];
                                var strLink = arrCurrent[3];
                                var strArgs = arrCurrent[4];
                                var strExpectedOutput = arrCurrent[5];
                                change_status(intCurrent, 'waiting', 'running');
                                var formData = new FormData();
                                var blob = new Blob(['SELECT \'This is some test sql\';'], { type: 'plain/text' });
                                formData.append('file_name', strArgs);
                                formData.append('file_content', blob);
                                var request = new XMLHttpRequest();
                                request.open('POST', strLink);
                                request.onload = function () {
                                        request.response = request.response.replace(/\r\n/gi, '\n');
                                        if (request.response === strExpectedOutput && intStatusCode === request.status) {
                                                change_status(intCurrent, 'running', 'pass');
                                                run_test(intCurrent + 1);
                                        } else {
                                                change_status(intCurrent, 'running', 'fail');
                                                document.getElementById('actual_status').value = request.status;
                                                document.getElementById('actual_output').value = request.response;
                                        }
                                };
                                request.send(formData);
                        } else if (strType === 'websocket start') {
                                change_status(intCurrent, 'waiting', 'running');
                                GS.envSocket = GS.openSocket('/postage/1/env');
                                var i = 0;
                                GS.requestFromSocket(GS.envSocket, 'INFO', function (data, error, errorData) {
                                        if (i === -1) {
                                                return;
                                        }
                                        i = -1;
                                        if (!error) {
                                                change_status(intCurrent, 'running', 'pass');
                                                run_test(intCurrent + 1);
                                        } else {
                                                change_status(intCurrent, 'running', 'fail');
                                                document.getElementById('actual_output').value = JSON.stringify(errorData);
                                        }
                                });
                        } else if (strType === 'websocket') {
                                arrCurrent[3] = arrCurrent[3].replace(/\r\n/gi, '\n');
                                var strArgs = arrCurrent[3];
                                var arrStrExpectedOutput = arrCurrent[4];
                                var arrStrActualOutput = [];
                                change_status(intCurrent, 'waiting', 'running');
                                var i = 0;
                                GS.requestFromSocket(GS.envSocket, strArgs, function (data, error, errorData) {
                                        if (i === -1) {
                                                return;
                                        }
                                        arrStrActualOutput.push(data.replace(/transactionid = .*\n/gim, ''));
                                        i += 1;
                                        if (i === arrStrExpectedOutput.length ||
							data === 'TRANSACTION COMPLETED' ||
							data.indexOf('FATAL') === 0
						) {
                                                console.log(i, data);
                                                var j, k, l, len, len1;
                                                for (j = 0, k = 0, len = i; j < len; j += 1, k += 1) {
                                                        if (typeof (arrStrExpectedOutput[k]) === 'string') {
                                                                console.log(j, arrStrActualOutput[j]);
                                                                console.log(k, arrStrExpectedOutput[k]);
                                                                if (arrStrActualOutput[j] === arrStrExpectedOutput[k] ||
                                                                        arrStrExpectedOutput[k] === 'ANYTHING' ||
                                                                        arrStrExpectedOutput[k].substring(0, 8) === 'OPTIONAL' ||
                                                                        (
                                                                                (
                                                                                        arrStrExpectedOutput[k] === 'START' ||
                                                                                        arrStrExpectedOutput[k] === 'END' ||
                                                                                        arrStrExpectedOutput[k] === 'Failed to get canonical path' ||
                                                                                        arrStrExpectedOutput[k] === 'Failed to open file for writing'
                                                                                ) &&
                                                                                arrStrActualOutput[j].indexOf(arrStrExpectedOutput[k]) === 0
                                                                        )
                                                                ) {
                                                                        if (arrStrExpectedOutput[k].substring(0, 8) === 'OPTIONAL' &&
                                                                                arrStrActualOutput[j] !== arrStrExpectedOutput[k].substring(8)
                                                                        ) {
                                                                                j -= 1;
                                                                        }
                                                                        error = false;
                                                                } else {
                                                                        change_status(intCurrent, 'running', 'fail');
                                                                        error = true;
                                                                        break;
                                                                }
                                                        } else {
                                                                error = true;
                                                                var arrPossibleOutputs = arrStrExpectedOutput[k];
                                                                for (l = 0, len1 = arrPossibleOutputs.length; l < len1; l += 1) {
                                                                        if (arrPossibleOutputs[l] == arrStrActualOutput[j]) {
                                                                                error = false;
                                                                                break;
                                                                        } else {
                                                                                error = true;
                                                                        }
                                                                }
                                                                if (error) {
                                                                        change_status(intCurrent, 'running', 'fail');
                                                                        break;
                                                                }
                                                        }
                                                }
                                                console.log(j - 1, k - 1, len, error);
                                                console.log(arrStrActualOutput[j - 1]);
                                                console.log(arrStrExpectedOutput[k - 1]);
                                                if (error === false) {
                                                        change_status(intCurrent, 'running', 'pass');
                                                        run_test(intCurrent + 1);
                                                        i = -1;
                                                } else {
                                                        change_status(intCurrent, 'running', 'fail');
                                                        document.getElementById('actual_output').value = JSON.stringify(arrStrActualOutput);
                                                        i = -1;
                                                }
                                        }
                                });
                        } else if (strType === 'websocket end') {
                                change_status(intCurrent, 'waiting', 'running');
                                GS.closeSocket(GS.envSocket);
                                change_status(intCurrent, 'running', 'pass');
                                run_test(intCurrent + 1);
                        }
                }
        </script>

        <style>
                .waiting {
                        background-color: #0000FF;
                        color: #FFFFFF;
                }

                .running {
                        background-color: #FFFF00;
                }

                .fail {
                        background-color: #FF0000;
                        color: #FFFFFF;
                }

                .pass {
                        background-color: #00FF00;
                }
        </style>
</head>
<body>
        <gs-page>
                <gs-body padded>
                        <center><h3>Postage Test Backend</h3></center>
                        <h3 style="float: right;"><span id="iterations">0</span> Successful Iterations</h3>
                        <gs-container id="container-tests" min-width="768px">
                                <gs-button onclick="bol_run = false; this.parentNode.removeChild(this);">Stop after this iteration</gs-button>
                                <p>The reason we only have one test going at a time, even though it is slower, is so that if there is a crash we know which call caused it.</p>
                                <div class="style-bracket-container">
                                        <label class="style-bracket-header">Tests</label>
                                        <div class="style-bracket-left"></div>
                                        <div class="style-bracket-right"></div>

                                        <gs-grid reflow-at="405px" widths="1" gutter id="gridtests">
                                        </gs-grid>
                                </div>
                                <label for="actual_status">Actual Status</label>
                                <gs-text id="actual_status"></gs-text>
                                <label for="actual_output">Actual Output</label>
                                <gs-memo id="actual_output"></gs-memo>
                        </gs-container>
                </gs-body>
        </gs-page>
</body>
</html>
